jQuery(document).ready(function(e){WPRUS.debug&&e('body').addClass('wprus-debug');var t=function(){e('.wprus-togglable').hide();e('.'+e('.nav-tab-active').data('toggle')).show();r();'wprus-site'===e('.nav-tab-active').data('toggle')&&!e('#postbox-container-2 .postbox.wprus-site').length?e('#sites_placeholder').show():e('#sites_placeholder').hide()},s=function(t){'undefined'!==typeof t&&t.attr('disabled','disabled');e.ajax({url:WPRUS.ajax_url,type:'POST',data:{action:'wprus_refresh_logs'},success:function(t){t.success&&(e('#logs_view').html(t.data.html),e('.logs-clean-trigger').val(t.data.clean_trigger_text))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){r();'undefined'!==typeof t&&t.removeAttr('disabled')}})},r=function(){var e=document.getElementById('logs_view');e.scrollTop=e.scrollHeight};e('.nav-tab').on('click',function(s){s.preventDefault();e('.nav-tab-active').removeClass('nav-tab-active');e(this).addClass('nav-tab-active');t()});e('.wprus-container').each(function(t,s){var r=e(s);r.closest('.postbox').addClass(r.data('postbox_class'))});t();e('#postbox-container-2 .wprus-site').closest('.postbox').addClass('closed');e('#normal-sortables').on('click','.handlediv, .wprus-site .hndle',function(t){t.preventDefault();e(this).closest('.postbox').toggleClass('closed')});e('#postbox-container-2').on('click','.deletion',function(t){t.preventDefault();var s=window.confirm(WPRUS.delete_site_confirm);s&&e(this).closest('.wprus-site').remove()});e('#wprus_add_trigger').on('click',function(s){s.preventDefault();var r=e('#wprus_add_value').val();if(!r||e('.wprus-site[data-url="'+r+'"]').length){return}if(!r.startsWith('http')){window.alert(WPRUS.http_required);return}var a=e('#postbox-container-2 .wprus-site-template').clone(),i=e('.wprus-site').length;a.find('input, select').each(function(t,s){var r=e(s);r.attr('name','wprus[sites]['+i+']'+r.data('name'))});a.find('.wprus-container').attr('data-url',r);a.find('.hndle span').html(r);a.find('input[type="hidden"]').val(r);a.removeClass('wprus-site-template').addClass('wprus-site');a.attr({'data-url':r,'id':'site_'+i});a.find('.wprus-select').select2({width:'100%'});a.find('.wprus-select-tag').select2({width:'100%',tags:!0});e('#site_template').before(a);t()});e('.wprus-site .wprus-select, .wprus-users .wprus-select').select2({width:'100%'});e('.wprus-site .wprus-select-tag').select2({width:'100%',tags:!0});e('#normal-sortables').on('change','.wprus-select-tag',function(){e(this).find('option').each(function(t,s){var r=e(s);r.attr('value',r.html())})});e('#normal-sortables').on('change','.action-checkbox input',function(){var t=e(this),s=t.closest('tr'),r=s.find('.action-test button');s.find('.action-test-result span').hide();t.prop('checked')?r.removeAttr('disabled'):r.attr('disabled','disabled')});e('#normal-sortables').on('click','.action-test button',function(t){t.preventDefault();var r=e(this),a=r.parent(),i=r.closest('tr'),o={site_url:r.closest('.wprus-container').data('url'),direction:a.data('direction'),data:{username:WPRUS.username},action:'wprus_'+a.data('action')+'_notify_ping_remote'};r.attr('disabled','disabled');i.find('.failure').hide();i.find('.success').hide();e.ajax({url:WPRUS.ajax_url,type:'POST',data:o,success:function(e){e.success?i.find('.success').show():(i.find('.failure').show(),setTimeout(function(){window.alert(e.data)},10))},error:function(e,t){i.find('.success').hide();i.find('.failure').show();setTimeout(function(){window.alert(WPRUS.undefined_error)},10);WPRUS.debug&&console.log(t)},complete:function(){r.removeAttr('disabled');s()}})});e('input[type="password"].toggle').on('focus',function(){e(this).attr('type','text')});e('input[type="password"].toggle').on('blur',function(){e(this).attr('type','password')});e('#wprus_log_refresh').on('click',function(t){t.preventDefault();s(e(this))});e('.logs-clean-trigger').on('click',function(t){t.preventDefault();var r=e(this);r.attr('disabled','disabled');e.ajax({url:WPRUS.ajax_url,type:'POST',data:{action:'wprus_clear_logs'},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){r.removeAttr('disabled');s()}})});e('#wprus_export_trigger').on('click',function(t){t.preventDefault();var s=e(this),r={action:'wprus_export_users',nonce:e('#wprus_import_export_nonce').val(),offset:e('#wprus_export_offset').val(),max:e('#wprus_export_max').val(),keep_role:e('#wprus_export_keep_roles').val(),user_roles:e('#wprus_roles_export_select').val(),meta_keys:e('#wprus_metadata_export_select').val(),doing_import_export_operation:1};console.log(r);s.attr('disabled','disabled');s.next().css('visibility','visible');e('.export-result').removeClass('show');e('.export-result a, .export-result-icons, .export-result-icons *').hide();e.ajax({url:WPRUS.ajax_url,type:'POST',data:r,success:function(t){t.success?(e('.export-result-icons .success').show(),e('.export-result a').show()):(t.data.file_name?(e('.export-result-icons .warning').show(),e('.export-result a').show()):e('.export-result-icons .failure').show());t.data&&t.data.file_name&&(e('.export-result a').attr('data-file_name',t.data.file_name),e('.export-result a').attr('href',WPRUS.download_url+'?wprus_file='+t.data.file_name+'&nonce='+r.nonce));t.data&&t.data.message&&(e('#export_message').html(t.data.message),e('.export-result-icons').show(),e('.export-result').addClass('show'))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){s.removeAttr('disabled');s.next().css('visibility','hidden')}})});e('.export-result a').on('click',function(t){if(e(this).hasClass('invalidate')){t.preventDefault();return}e(this).addClass('invalidated')});e('#wprus_import_file').on('change',function(){var t=e(this);0<t.prop('files').length?(e('#wprus_import_file_filename').val(t.prop('files')[0].name),e('#wprus_import_file_trigger').removeAttr('disabled')):(e('#wprus_import_file_filename').val(''),e('#wprus_import_file_trigger').attr('disabled','disabled'))});e('#wprus_import_file_dropzone').on('drag dragstart dragend dragover dragenter dragleave drop',function(e){e.preventDefault();e.stopPropagation()}).on('drop',function(t){var s=e('#wprus_import_file');s.prop('files',t.originalEvent.dataTransfer.files);s.trigger('change')});e('#wprus_import_file_trigger').on('click',function(t){t.preventDefault();var s=e(this),r=!0,a=new FormData,i=e('#wprus_import_file').prop('files')[0],o=/^([a-zA-Z0-9\-\_]*)\.dat/gm,n=e('#wprus_import_results .summary'),l=e('#wprus_import_results .errors');s.attr('disabled','disabled');s.next().css('visibility','visible');n.hide();l.hide();typeof i!=='undefined'&&typeof i.type!=='undefined'&&typeof i.size!=='undefined'&&typeof i.name!=='undefined'?(o.test(i.name)||(window.alert(WPRUS.invalid_file_name),r=!1)):(window.alert(WPRUS.invalid_file),r=!1);r?(a.append('action','wprus_import_users'),a.append('file',i),a.append('nonce',e('#wprus_import_export_nonce').val()),a.append('doing_import_export_operation',1),e.ajax({url:WPRUS.ajax_url,data:a,type:'POST',cache:!1,contentType:!1,processData:!1,success:function(t){t.data&&(t.data.message&&(n.html(t.data.message),n.show()),t.data.errors&&(l.html(''),e.each(t.data.errors,function(t,s){var r=e('<li>'+s+'</li>');l.append(r)}),l.show()))},error:function(e,t){n.html(WPRUS.undefined_import_error);n.show();WPRUS.debug&&console.log(t)},complete:function(){s.removeAttr('disabled');s.next().css('visibility','hidden')}})):(s.next().css('visibility','hidden'),s.removeAttr('disabled'))});e('.wprus-help-title').on('click',function(t){t.preventDefault();e(this).next().slideToggle(200)});e('.wprus-ui-wait').show()})